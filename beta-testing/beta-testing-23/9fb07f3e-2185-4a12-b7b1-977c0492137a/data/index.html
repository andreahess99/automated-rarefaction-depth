<!-- head copied from https://github.com/bokulich-lab/q2-fastp/blob/main/q2_fastp/assets/index.html
and https://github.com/bokulich-lab/q2-moshpit/blob/main/q2_moshpit/assets/busco/feature_data/index.html-->

<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>automated_rarefaction_depth : _beta_viz</title>
    <link rel="stylesheet" href="./q2templateassets/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="./q2templateassets/css/normalize.css"/>
    <link rel="stylesheet" href="./q2templateassets/css/base-template.css"/>
    <script src="./q2templateassets/js/jquery-3.2.0.min.js" charset="utf-8"></script>
    <script src="./q2templateassets/js/bootstrap.min.js" charset="utf-8"></script>
    
<title>Embedding Vega-Lite</title>
<script src="./js/bootstrapMagic.js" type="text/javascript"></script>
<link href="./css/styles.css" rel="stylesheet"/>
<script type="text/javascript">
    // temporary hack to make it look good with Bootstrap 5
    removeBS3refs();
</script> 
<script src="https://cdn.jsdelivr.net/npm//vega@5" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/npm//vega-lite@5.16.3" type="text/javascript"></script> 
<script src="https://cdn.jsdelivr.net/npm//vega-embed@6" type="text/javascript"></script>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha256-YvdLHPgkqJ8DVUxjjnGVlMMJtNimJ6dYkowFFvp4kKs=" rel="stylesheet"/>


  </head>
  <body>
    <div class="container-fluid">
      <div id="q2templatesheader" class="row">
        <div class="col-lg-12">
          <a href="http://qiime2.org/">
            <img src="./q2templateassets/img/qiime2-rect-200.png"
            alt="QIIME 2">
          </a>
        </div>
      </div>
        

  <div class="row">
    <div class="col-lg-12">
        <div class="card">
            <h5 class="card-header">Automated Rarefaction Depth Summary</h5>
            <div class="card-body">
                
                    <p>
                        This visualization shows the rarefaction analysis for the beta diversity metric braycurtis.
                    </p>
                    <div class="col-lg-12" id="plots_summary" style="max-height: 480px; overflow: hidden;"></div> 
                        <div id="plots" style="width: 100%; height: 350px;"></div>  
                    </div>
                    <p>
                        Knee point: 2117.5 (at the 0 percentile)<br>
                    </p>
                
            </div>   
        </div> 
    </div>
  </div>


  <script id="vega_json" type="application/json">
    {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json",
  "config": {
    "axis": {
      "labelFont": "system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif",
      "labelFontSize": 14,
      "titleFont": "system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif",
      "titleFontSize": 13
    },
    "header": {
      "labelFont": "system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif",
      "labelFontSize": 14,
      "titleFont": "system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif",
      "titleFontSize": 13
    },
    "legend": {
      "labelFont": "system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif",
      "labelFontSize": 14,
      "titleFont": "system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif",
      "titleFontSize": 14
    },
    "text": {
      "font": "system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif",
      "fontSize": 16
    },
    "title": {
      "font": "system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif"
    }
  },
  "datasets": {
    "data-05be334b249353a817df8832f02b7847": [
      {
        "position": 2117.5
      }
    ],
    "data-07f75d37988a109c79301439944e40bb": [
      {
        "calc_array": 0.005357773539591721,
        "max_range": 907.5
      },
      {
        "calc_array": 0.002577207481513696,
        "max_range": 1512.5
      },
      {
        "calc_array": 0.0017600244872972078,
        "max_range": 2117.5
      },
      {
        "calc_array": 0.0014352617079889784,
        "max_range": 2722.5
      },
      {
        "calc_array": 0.00109345200254291,
        "max_range": 3327.5
      },
      {
        "calc_array": 0.0008714655408870209,
        "max_range": 3932.5
      },
      {
        "calc_array": 0.0005353863308408659,
        "max_range": 4537.5
      },
      {
        "calc_array": 0.0014424548515457603,
        "max_range": 5142.5
      }
    ],
    "data-27d844e5c5b053990c0409f59f5f6cdd": [
      {
        "position": 0
      }
    ],
    "data-475bab9f4dd952e0ba08c4f35aee19fd": [
      {
        "text": ""
      }
    ],
    "data-8b9b7bbc32184f6aaa2eb3c58dc13fef": [
      {
        "text": "\n\n"
      }
    ],
    "data-93d4db20139534b41115f614217af3e5": [
      {
        "max_range": 1,
        "num_samples_left": 34
      },
      {
        "max_range": 605,
        "num_samples_left": 33
      },
      {
        "max_range": 1210,
        "num_samples_left": 27
      },
      {
        "max_range": 1815,
        "num_samples_left": 20
      },
      {
        "max_range": 2420,
        "num_samples_left": 18
      },
      {
        "max_range": 3025,
        "num_samples_left": 15
      },
      {
        "max_range": 3630,
        "num_samples_left": 14
      },
      {
        "max_range": 4235,
        "num_samples_left": 12
      },
      {
        "max_range": 4840,
        "num_samples_left": 9
      },
      {
        "max_range": 5445,
        "num_samples_left": 4
      }
    ]
  },
  "hconcat": [
    {
      "spacing": 0,
      "vconcat": [
        {
          "data": {
            "name": "data-8b9b7bbc32184f6aaa2eb3c58dc13fef"
          },
          "encoding": {
            "text": {
              "field": "text",
              "type": "nominal"
            }
          },
          "height": 50,
          "mark": {
            "align": "left",
            "baseline": "top",
            "dx": -95,
            "fontSize": 12,
            "lineBreak": "\n",
            "size": 6,
            "type": "text"
          },
          "width": 100
        },
        {
          "spacing": 0,
          "vconcat": [
            {
              "height": 300,
              "layer": [
                {
                  "data": {
                    "name": "data-07f75d37988a109c79301439944e40bb"
                  },
                  "encoding": {
                    "x": {
                      "field": "max_range",
                      "title": "Read Depth",
                      "type": "quantitative"
                    },
                    "y": {
                      "field": "calc_array",
                      "title": "Calculated Value",
                      "type": "quantitative"
                    }
                  },
                  "mark": {
                    "point": true,
                    "type": "line"
                  },
                  "name": "view_1",
                  "title": "Beta Rarefaction Curve"
                },
                {
                  "data": {
                    "name": "data-05be334b249353a817df8832f02b7847"
                  },
                  "encoding": {
                    "x": {
                      "field": "position",
                      "type": "quantitative"
                    }
                  },
                  "mark": {
                    "color": "red",
                    "strokeWidth": 2,
                    "type": "rule"
                  }
                },
                {
                  "data": {
                    "name": "data-27d844e5c5b053990c0409f59f5f6cdd"
                  },
                  "encoding": {
                    "x": {
                      "field": "position",
                      "type": "quantitative"
                    }
                  },
                  "mark": {
                    "color": "black",
                    "strokeDash": [
                      4,
                      4
                    ],
                    "strokeWidth": 2,
                    "type": "rule"
                  },
                  "transform": [
                    {
                      "as": "position",
                      "calculate": "position"
                    },
                    {
                      "filter": {
                        "param": "param_2"
                      }
                    }
                  ]
                }
              ],
              "resolve": {
                "scale": {
                  "x": "shared",
                  "y": "shared"
                }
              },
              "width": 400
            },
            {
              "data": {
                "name": "data-475bab9f4dd952e0ba08c4f35aee19fd"
              },
              "encoding": {
                "text": {
                  "field": "text",
                  "type": "nominal"
                }
              },
              "height": 50,
              "mark": {
                "align": "left",
                "baseline": "top",
                "dx": -95,
                "fontSize": 16,
                "lineBreak": "\n",
                "size": 6,
                "type": "text"
              },
              "width": 100
            }
          ]
        }
      ]
    },
    {
      "spacing": 0,
      "vconcat": [
        {
          "data": {
            "name": "data-8b9b7bbc32184f6aaa2eb3c58dc13fef"
          },
          "encoding": {
            "text": {
              "field": "text",
              "type": "nominal"
            }
          },
          "height": 50,
          "mark": {
            "align": "left",
            "baseline": "top",
            "dx": -95,
            "fontSize": 12,
            "lineBreak": "\n",
            "size": 6,
            "type": "text"
          },
          "width": 100
        },
        {
          "spacing": 0,
          "vconcat": [
            {
              "data": {
                "name": "data-93d4db20139534b41115f614217af3e5"
              },
              "encoding": {
                "x": {
                  "field": "max_range",
                  "title": "Read Depth",
                  "type": "quantitative"
                },
                "y": {
                  "field": "num_samples_left",
                  "title": "Number of Samples Left",
                  "type": "quantitative"
                }
              },
              "height": 300,
              "mark": {
                "color": "steelblue",
                "type": "bar"
              },
              "title": "Samples Remaining per Rarefaction Depth",
              "width": 400
            },
            {
              "data": {
                "name": "data-475bab9f4dd952e0ba08c4f35aee19fd"
              },
              "encoding": {
                "text": {
                  "field": "text",
                  "type": "nominal"
                }
              },
              "height": 50,
              "mark": {
                "align": "left",
                "baseline": "top",
                "dx": -95,
                "fontSize": 16,
                "lineBreak": "\n",
                "size": 6,
                "type": "text"
              },
              "width": 100
            }
          ]
        }
      ]
    }
  ],
  "padding": {
    "bottom": 0,
    "left": 0,
    "right": 0,
    "top": 0
  },
  "params": [
    {
      "bind": "scales",
      "name": "param_1",
      "select": {
        "type": "interval"
      },
      "views": [
        "view_1"
      ]
    },
    {
      "bind": {
        "input": "checkbox",
        "name": "Show read depth specified by slider as a line on the plot: "
      },
      "name": "param_2"
    },
    {
      "bind": {
        "input": "range",
        "max": 5142.5,
        "min": 0,
        "name": "Rarefaction Depth Line",
        "step": 20
      },
      "name": "position",
      "value": 2117.5
    }
  ],
  "spacing": 60
}
  </script>

  <script type="text/javascript">
    $(document).ready(function () {
        const vegaSpecSummary = JSON.parse(document.getElementById('vega_json').textContent);
            vegaEmbed("#plots", vegaSpecSummary).then(
                function (result) {
                    result.view.logLevel(vega.Warn);
                    window.v = result.view;
                }
            ).catch(
                function (error) {
                    handleErrors([error], $("#plots"));
                }
            );
    });
  </script>   
  

  <script>
    // data injected from python
    const kneePoint = 2117.5;
    const lowerValue = 0;
    const upperValue = 0;
    const depthThreshold = 0;
    const percentSamples100 = 0;
    const percentileKP = 0;
    const lowerPercentile = 0;
    const upperPercentile = 0;
    const addText = false;
    const graphData = "braycurtis";
    const graphName = "braycurtis";
    const maxReadPercentile = 0;
    const isBeta = true;
    const betaMetric = "braycurtis";
  </script>


    </div>
    <script type="text/javascript">
      if (window.frameElement) {
          document.getElementById('q2templatesheader').remove();
      }
    </script>
    





<script type="text/javascript">
  function handleErrors(errors, element, msg) {
    console.error(errors);
    msg = msg === undefined ? '' : msg + '<br><br>';
    var helpMsg = '<p class="alert alert-danger"> \
                   There was an error loading and rendering the \
                   visualization.<br><br>' + msg + 'Please \
                   copy-and-paste the following error messages when \
                   reporting this error (please be aware that the content \
                   of your analysis data and/or metadata is included in \
                   these messages):</p>';
    var helpMsgDiv = $('<div></div>');
    helpMsgDiv.append(helpMsg);
    helpMsgDiv.append('<pre><code>' + errors.join('\n\n') + '</code></pre>');
    element.replaceWith(helpMsgDiv);
  }
  window.onerror = function(error) {
    handleErrors([error], $('#loading'));
  };
</script>

  </body>
</html>